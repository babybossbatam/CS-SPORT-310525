typeof country !== "string" ||
        country.trim() === ""
      ) {
        // Skip fixtures with truly missing country data
        console.warn(`[COUNTRY DEBUG] Skipping fixture with missing country data:`, {
          leagueName: league.name,
          leagueId: league.id,
          originalCountry: country,
          homeTeam: fixture.teams?.home?.name,
          awayTeam: fixture.teams?.away?.name,
          selectedDate: selectedDate,
        });
        return acc;
      }

      const validCountry = country.trim();

      // Handle World country explicitly
      if (validCountry === "World") {
        console.log(`üåç [WORLD DEBUG] Processing World country fixture:`, {
          leagueName: league.name,
          leagueId: league.id,
          homeTeam: fixture.teams?.home?.name,
          awayTeam: fixture.teams?.away?.name,
        });
      }

      // Only allow valid country names, World, and Europe
      if (
        validCountry !== "World" &&
        validCountry !== "Europe" &&
        validCountry.length === 0
      ) {
        return acc;
      }

      const leagueId = league.id;
      if (!acc[country]) {
        acc[country] = {
          country,
          flag: getCountryFlagWithFallbackSync(country, league.flag),
          leagues: {},
          hasPopularLeague: false,
        };
      }

      // Check if this is a popular league for this country
      const countryPopularLeagues = POPULAR_LEAGUES_BY_COUNTRY[country] || [];
      const isPopularForCountry = countryPopularLeagues.includes(leagueId);
      const isGloballyPopular = POPULAR_LEAGUES.includes(leagueId);

      // For unrestricted countries (Brazil, Colombia, Saudi Arabia, USA, UAE, Europe, South America, World),
      // consider all leagues as "popular" to show them all
      const unrestrictedCountries = [
        "Brazil",
        "Colombia",
        "Saudi Arabia",
        "USA",
        "United States",
        "United-States",
        "US",
        "United Arab Emirates",
        "United-Arab-Emirates",
        "Europe",
        "South America",
        "World",
      ];
      const isUnrestrictedCountry = unrestrictedCountries.includes(country);

      if (isPopularForCountry || isGloballyPopular || isUnrestrictedCountry) {
        acc[country].hasPopularLeague = true;
      }

      if (!acc[country].leagues[leagueId]) {
        // For unrestricted countries (Brazil, Colombia, Saudi Arabia, USA, UAE, Europe, South America, World),
        // consider all leagues as "popular" to show them all
        const unrestrictedCountries = [
          "Brazil",
          "Colombia",
          "Saudi Arabia",
          "USA",
          "United States",
          "United-States",
          "US",
          "United Arab Emirates",
          "United-Arab-Emirates",
          "Europe",
          "South America",
          "World",
        ];
        const isUnrestrictedCountry = unrestrictedCountries.includes(country);

        acc[country].leagues[leagueId] = {
          league: {
            ...league,
            logo:
              league.logo ||
              "https://media.api-sports.io/football/leagues/1.png",
          },
          matches: [],
          isPopular:
            isPopularForCountry || isGloballyPopular || isUnrestrictedCountry,
          isPopularForCountry: isPopularForCountry || isUnrestrictedCountry,
          isFriendlies: league.name.toLowerCase().includes("friendlies"),
        };